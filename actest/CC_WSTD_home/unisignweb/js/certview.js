var __certview=function(a){var B=function(r){function y(a){if(!a)return alert("UI load error."),!1;var b=document.createElement("div");document.body.insertBefore(b,document.body.firstChild);b.innerHTML=a;return!0}function m(){x.restoreOnMouseEvent();r.onCancel()}function q(c){c=parseInt(c);var b=document.getElementById("us-view-simple"),f=document.getElementById("us-view-detail"),d=document.getElementById("us-view-certpath"),g=document.getElementById("us-view-cert-cps-btn");document.getElementById("us-view-cert-confirm-btn");document.getElementById("us-view-cls-img-btn");0===c?(b.style.display="block",f.style.display="none",d&&(d.style.display="none"),a.uiUtil().isIraq()?g.style.display="none":g.style.display="inline",x.clearList()):1===c?(b.style.display="none",f.style.display="block",d&&(d.style.display="none"),g.style.display="none",x.redrawList(z.list,z.list.length)):2===c&&(b.style.display="none",f.style.display="none",d.style.display="block",g.style.display="none")}function u(a,b){a=a||window.event;a=a.target||a.srcElement;b=b.getElementsByTagName("a");var c=document.getElementById("us-view-tab-simple"),d=document.getElementById("us-view-tab-detail"),g=document.getElementById("us-view-tab-certpath");for(nTab in b)if(a==b[nTab]){isNaN(nTab)&&("us-view-tab-simple"==nTab?nTab=0:"us-view-tab-detail"==nTab?nTab=1:"us-view-tab-certpath"==nTab&&(nTab=2));0==nTab?(c.className="us-view-tab-tag active",d.className="us-view-tab-tag",g&&(g.className="us-view-tab-tag")):1==nTab?(c.className="us-view-tab-tag",d.className="us-view-tab-tag active",g&&(g.className="us-view-tab-tag")):2==nTab&&(c.className="us-view-tab-tag",d.className="us-view-tab-tag",g.className="us-view-tab-tag active");q(nTab);break}}function G(c,b,f,d){a.usWebToolkit.x509Certificate.parser(d,f);d=a.usWebToolkit.x509Certificate.getVersion();var g=a.usWebToolkit.x509Certificate.getSerialNumber(),k=a.usWebToolkit.x509Certificate.getSignAlgo(),h=a.usWebToolkit.x509Certificate.getIssuerName(),l=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()),H=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()),e=a.usWebToolkit.x509Certificate.getSubjectName(),t=a.usWebToolkit.x509Certificate.getPublickey(),C=a.usWebToolkit.x509Certificate.getAuthorityKeyIdentifier(),I=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),A=a.usWebToolkit.x509Certificate.getKeyUsage(),D=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),q=a.usWebToolkit.x509Certificate.getSubjectAltName(),p=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess(),r=a.usWebToolkit.x509Certificate.getcRLDistributionPoints();a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS();a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice();var m="";try{m=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(J){m=""}var w="";try{w=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(J){w=""}var u=a.usWebToolkit.x509Certificate.getSignature();f=[];f[0]=d;f[1]=g;f[2]=k;f[3]=h;f[4]=l;f[5]=H;f[6]=e;f[7]=t;"MPKI"==a.ESVS.PKI?(f[8]=A,f[9]=D,f[10]=r,f[11]=u):(f[8]=C,f[9]=I,f[10]=A,f[11]=D,f[12]=q,f[13]=p,f[14]=r,f[15]=m,f[16]=w,f[17]=u);d=[];for(g=0;g<f.length;g++)k=[],k[0]=b[g].field,k[1]=f[g],d[g]=k;z={list:d};E=a.loadUI("gridlist");x=E({type:"detailslist",tblid:"us-view-tbl-list",tbltitleid:"us-view-tbl-list-th",titlelistid:"us-view-grid-head-div",titlerowid:"us-view-list-title-row",titleelementid:"us-view-list-title-element",titledividerid:null,titlelistcn:"us-layout-view-grid-head-div",titlerowcn:"us-layout-view-grid-head-row",titleelementcn:"us-layout-view-grid-row-title-element",titledividercn:null,tblbodyid:"us-view-tbl-list-td",datalistid:"us-view-grid-body-div",datarowid:"us-view-list-body-row",dataelementid:"us-view-list-data-element",datalistcn:"us-layout-view-grid-body-div",datarowcn:"us-layout-view-grid-body-row",dataelementcn:"us-layout-view-grid-row-data-element",dataselectcn:"us-layout-view-grid-row-data-selected-element",textboxid:"us-view-detail-text-box"});x.drawTitle(c,c.length,v+3,!1)}function w(c,b,f,d,g){if(!c||0>=b||!f||!d)return!1;var k=document.getElementById("us-view-cert-status-img"),h=document.getElementById("us-view-cert-status-msg"),l=-1;if(4<=a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice))a.SELECTINFO.curdevice!=a.CONST.__USFB_M_DISK.device&&a.SELECTINFO.curdevice!=a.CONST.__USFB_M_HDD.device||null==a.Whale()?a.nimservice()?a.nimservice().VerifyCertificate(b,1,function(b,e){if(0===b)p=!0,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_VALID));else switch(p=!1,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),b){case 3005:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_EXPIRED));break;case 3016:case 3017:case 3900:case 3901:case 3902:case 3903:case 3904:case 3905:case 3906:case 3907:case 3908:case 3909:case 3999:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_REVOKED));__RevokedStatus=!0;break;case 4212E4:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_EXPIRED));__RevokedStatus=!0;break;default:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_INVALID))}g(0)}):(a.uiUtil().msgBox(__lang.IDS_MSGBOX_NIM_ERROR_UNLOAD),rv=-1,g(-1)):a.Whale().verifyCertitficate(b,function(b,e){if(0===b)p=!0,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_VALID));else switch(p=!1,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),b){case 3005:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_EXPIRED));break;case 3016:case 3017:case 3900:case 3901:case 3902:case 3903:case 3904:case 3905:case 3906:case 3907:case 3908:case 3909:case 3999:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_REVOKED));__RevokedStatus=!0;break;case 4212E4:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_EXPIRED));__RevokedStatus=!0;break;default:h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_INVALID))}g(0)});else if(2&a.ESVS.Mode){b=null;try{var m=a.usWebToolkit.pki.createCaStore();b=a.PFSH.GetCACerts();for(var e in b)caCert=b[e],m.addCertificate(a.usWebToolkit.pki.certificateFromBase64(caCert));var t=a.usWebToolkit.pki.certificateFromBase64(f);a.usWebToolkit.pki.verifyCertificateChain(m,t,function(b,e,c){null!=k&&null!=h&&(!0===b?(l=0,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_VALID)),p=!0):(l=-1,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),null!=c&&void 0!=c&&0<=c.indexOf("Certificate is not valid yet or has expired")?h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_EXPIRED)):null!=c&&void 0!=c&&0<=c.indexOf("no parent issuer, so certificate not trusted")?h.appendChild(document.createTextNode(d.IDS_CERT_STATUS_ISSUER_FAIL)):h.appendChild(document.createTextNode(c)),p=!1),g(l))})}catch(C){}}(function(){a.usWebToolkit.x509Certificate.parser(f,c);document.getElementById("us-view-cert-subject-name-data").appendChild(document.createTextNode(a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())));var b=document.getElementById("us-view-cert-issuer-name-data"),e=a.certUtil().getCN(a.usWebToolkit.x509Certificate.getIssuerName());if(""==e||"undefined"==e)e=a.certUtil().getO(a.usWebToolkit.x509Certificate.getIssuerName());b.appendChild(document.createTextNode(e));document.getElementById("us-view-cert-validity-date-from").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())));document.getElementById("us-view-cert-validity-date-to").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter())));b=document.getElementById("us-view-cert-purpose");e=null;try{e=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(A){e=""}null!=e&&b.appendChild(document.createTextNode(e));b=document.getElementById("us-view-cert-cps-btn");if("MPKI"==a.ESVS.PKI||a.uiUtil().isIraq())b.style.visibility="hidden";b.onclick=function(){var b=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS();"firefox"==a.browserName?window.open(b,"cps_url","scrollbars=1"):window.open(b);this.focus()}})();return!0}function B(a){if(null==a||0==a.length)return"";for(var b=a.length,c="",d=0,g=b;d<b;d++,g--)0==g%4&&g!=b&&(c+=" "),c+=a.charAt(d);return c.toUpperCase()}function F(c,b,f,d,g){function k(a,b){(a=document.getElementById(a))&&a.appendChild(document.createTextNode(b))}function h(a,b){var e=document.createElement("li");1==a?e.setAttribute("class","valid"):0==a?e.setAttribute("class","invalid"):null!=a?e.setAttribute("class",a):e.appendChild(document.createTextNode(b));return e}function l(b,e){var c=null;if(null==b||0>=b.length)return null;b=a.usWebToolkit.x509Certificate.parser(b,e);b=a.usWebToolkit.asn1.fromDer(b.getExtension("authorityKeyIdentifier").value);e=a.usWebToolkit.util.bytesToHex(b.value[0].value);b.value[2]&&(e+="_"+parseInt(a.usWebToolkit.util.bytesToHex(b.value[2].value),16));caCerts=a.PFSH.GetCACerts();for(var d in caCerts)d.toUpperCase()==e.toUpperCase()&&(c=caCerts[d]);return c}function m(b,g,m){try{a.usWebToolkit.x509Certificate.parser(g,c);e.appendChild(h(!0));e.appendChild(h(null,a.usWebToolkit.x509Certificate.getSubjectName()));k("us-view-certpath-version",d.IDS_CERT_PATH_ROOTCA_VERSION);k("us-view-certpath-version-data",a.usWebToolkit.x509Certificate.getVersion());k("us-view-certpath-date",d.IDS_CERT_PATH_ROOTCA_VALIDDATE);k("us-view-certpath-date-from",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()));k("us-view-certpath-date-to",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()));a.usWebToolkit.x509Certificate.parser(b,c);e.appendChild(h("dot"));e.appendChild(h(!0));e.appendChild(h(null,a.usWebToolkit.x509Certificate.getSubjectName()));a.usWebToolkit.x509Certificate.parser(f,c);e.appendChild(h("dot2"));e.appendChild(h(p));e.appendChild(h(null,a.usWebToolkit.x509Certificate.getSubjectName()));var l=B(m);if(null==l||0==l.length)l="  ";k("us-view-certpath-hash",d.IDS_CERT_PATH_NOTICE);k("us-view-certpath-hash-data",l);k("us-view-certpath-tail",d.IDS_CERT_PATH_ROOTHASH_URL);k("us-view-certpath-tail",d.IDS_CERT_PATH_ROOTHASH_URL2);k("us-view-certpath-tail",d.IDS_CERT_PATH_ROOTHASH_URL3);document.getElementById("us-view-certpath-tail").setAttribute("tabindex",v+5,0);document.getElementById("us-view-certpath-tail").setAttribute("title",d.IDS_LINK_TITLE,0);document.getElementById("us-view-certpath-tail").onclick=function(){window.open(d.IDS_CERT_PATH_ROOTHASH_LINK,"ca_hash","scrollbars=1;width=650;height=460;")};document.getElementById("us-view-certpath-tail").onkeydown=function(a){13==a.keyCode&&window.open(d.IDS_CERT_PATH_ROOTHASH_LINK,"ca_hash","scrollbars=1;width=650;height=460;")}}catch(M){a.usWebToolkit.x509Certificate.parser(f,c),e&&e.appendChild(h(p)),e&&e.appendChild(h(null,a.usWebToolkit.x509Certificate.getSubjectName()))}}"MPKI"==a.ESVS.PKI&&g();if(4&a.ESVS.Mode&&!a.nimservice())a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD);else{var e=document.getElementById("us-view-certpath-info-tree");if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice))a.SELECTINFO.curdevice!=a.CONST.__USFB_M_DISK.device&&a.SELECTINFO.curdevice!=a.CONST.__USFB_M_HDD.device||null==a.Whale()?a.nimservice().GetCACertificates(b,function(b,d,k,l,t){a.uiUtil().loadingBox(!1,"us-div-list-load");null!=e&&(0==b?m(k,l,t):(a.usWebToolkit.x509Certificate.parser(f,c),e&&e.appendChild(h(p)),e&&e.appendChild(h(null,a.usWebToolkit.x509Certificate.getSubjectName()))),g())}):a.Whale().getCACertificates(b,function(b,d,k,l,t){a.uiUtil().loadingBox(!1,"us-div-list-load");null!=e&&(0==b?m(k,l,t):(a.usWebToolkit.x509Certificate.parser(f,c),e&&e.appendChild(h(p)),e&&e.appendChild(h(null,a.usWebToolkit.x509Certificate.getSubjectName()))),g())});else if(2&a.ESVS.Mode){var t=b=null;b=l(f,c);t=l(b,c);null!=b&&null!=t?m(b,t):(a.usWebToolkit.x509Certificate.parser(f,c),e&&e.appendChild(h(p)),e&&e.appendChild(h(null,a.usWebToolkit.x509Certificate.getSubjectName())));g()}}}var K=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");"MPKI"==a.ESVS.PKI?c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certview_verisign.html?version="+a.ver,!1):c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certview.html?version="+a.ver,!1);c.send(null);return c.responseText},L=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certview_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},E=null,x=null,z=null,p=!0,v=a.ESVS.TabIndex;return function(){var c=a.CustomEval(K),b=a.CustomEval(L,!0),f=r.args.type,d=r.args.idx,g=r.args.cert;y(c());var k=document.getElementById("us-view-lbl-title");k.appendChild(document.createTextNode(b.IDS_CERT_VIEW));k.setAttribute("tabindex",v,0);c=document.getElementById("us-view-tab");c.onclick=function(a){u(a?a:event,this)};c.onkeydown=function(a){if((a=a?a:event)&&this){var b=a||window.event;13==(b.which||b.keyCode)&&u(a,this)}};c=document.getElementById("us-view-tab-simple");c.setAttribute("tabindex",v+1,0);c.appendChild(document.createTextNode(b.IDS_CERT_SIMPLE_VIEW));c.onfocus=function(a){a.target.style.border="1px dotted"};c.onblur=function(a){a.target.style.border=""};document.getElementById("us-view-simple").setAttribute("tabindex",v+2,0);c=document.getElementById("us-view-tab-detail");c.appendChild(document.createTextNode(b.IDS_CERT_DETAIL_VIEW));c.setAttribute("tabindex",v+3,0);c.onfocus=function(a){a.target.style.border="1px dotted"};c.onblur=function(a){a.target.style.border=""};if(c=document.getElementById("us-view-tab-certpath"))c.appendChild(document.createTextNode(b.IDS_CERT_PATH_VIEW)),c.setAttribute("tabindex",v+4,0),c.onfocus=function(a){a.target.style.border="1px dotted"},c.onblur=function(a){a.target.style.border=""};document.getElementById("us-view-cert-info").appendChild(document.createTextNode(b.IDS_CERT_INFO));document.getElementById("us-view-cert-subject-name").appendChild(document.createTextNode(b.IDS_CERT_SUBJECT_NAME));document.getElementById("us-view-cert-issuer-name").appendChild(document.createTextNode(b.IDS_CERT_ISSUER_NAME));document.getElementById("us-view-cert-validity-date").appendChild(document.createTextNode(b.IDS_CERT_VALIDITY_DATE));c=document.getElementById("us-view-cert-cps-btn");c.setAttribute("value",b.IDS_CERT_SUPPLEMENT_INFO,0);c.setAttribute("tabindex",v+6,0);c.setAttribute("title",b.IDS_LINK_TITLE,0);c.style.display="none";var h=document.getElementById("us-view-cert-confirm-btn");h.setAttribute("value",b.IDS_CERT_CONFIRM,0);h.setAttribute("tabindex",v+7,0);h.onclick=function(){m()};var l=document.getElementById("us-view-cls-img-btn");l.setAttribute("alt",b.IDS_CERT_VIEW_CLOSE,0);l.setAttribute("tabindex",v+8,0);l.onclick=function(){m()};l.onfocus=function(a){l.style.border="1px dotted white"};document.getElementById("us-view-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/x-btn.png",0);l.onkeydown=function(a){var b=a||window.event,c=b.which||b.keyCode;9==c&&b.shiftKey&&(l.onblur=function(){l.style.border="";setTimeout(function(){h.focus()},10)});9!=c||b.shiftKey||(l.onblur=function(){l.style.border="";setTimeout(function(){k.focus()},10)});13==a.keyCode&&(a.preventDefault(),m())};var p=!1;k.onkeyup=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&p&&(p=!1,setTimeout(function(){l.focus()},10))};k.onkeydown=function(a){a=a||window.event;if(9==(a.which||a.keyCode)&&a.shiftKey)return a.cancelBubble=!0,p=a.returnValue=!0,!1};G([{title:b.IDS_CERT_FIELD},{title:b.IDS_CERT_VALUE}],"MPKI"==a.ESVS.PKI?[{field:b.IDS_CERT_VERSION},{field:b.IDS_CERT_SERIAL_NUMBER},{field:b.IDS_CERT_SIGN_ALGOLISM},{field:b.IDS_CERT_ISSUER},{field:b.IDS_CERT_VALIDATE_FROM},{field:b.IDS_CERT_VALIDATE_TO},{field:b.IDS_CERT_SUBJECT},{field:b.IDS_CERT_PUBLIC_KEY},{field:b.IDS_CERT_KEY_USAGE},{field:b.IDS_CERT_POLICY},{field:b.IDS_CERT_CRL_DISTRIBUTE_POINTS},{field:b.IDS_CERT_SIGNATURE}]:[{field:b.IDS_CERT_VERSION},{field:b.IDS_CERT_SERIAL_NUMBER},{field:b.IDS_CERT_SIGN_ALGOLISM},{field:b.IDS_CERT_ISSUER},{field:b.IDS_CERT_VALIDATE_FROM},{field:b.IDS_CERT_VALIDATE_TO},{field:b.IDS_CERT_SUBJECT},{field:b.IDS_CERT_PUBLIC_KEY},{field:b.IDS_CERT_AUTHORITY_KEY_IDENTIFIER},{field:b.IDS_CERT_SUBJECT_KEY_IDENTIFIER},{field:b.IDS_CERT_KEY_USAGE},{field:b.IDS_CERT_POLICY},{field:b.IDS_CERT_SUBJECT_ALT_NAME},{field:b.IDS_CERT_AUTHORITY_INFO_ACCESS},{field:b.IDS_CERT_CRL_DISTRIBUTE_POINTS},{field:b.IDS_CERT_CPS},{field:b.IDS_CERT_PURPOSE},{field:b.IDS_CERT_SIGNATURE}],f,g);4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice)?w(f,d,g,b,function(a){F(f,d,g,b,function(a){})}):2&a.ESVS.Mode?w(f,d,g,b,function(a){F(f,d,g,b,function(a){})}):(w(f,d,g,b),document.getElementById("us-view-tab3").style.display="none");q(0);return document.getElementById("us-div-cert-view")}()};return function(r){var y=a.uiLayerLevel,m=a.uiUtil().getOverlay(y),q=B({type:r.type,args:r.args,onConfirm:r.onConfirm,onCancel:r.onCancel});q.style.zIndex=y+1;a.ESVS.TargetObj.insertBefore(m,a.ESVS.TargetObj.firstChild);var u=window.onresize;return{show:function(){a.ActiveUI=this;draggable(q,document.getElementById("us-div-view-title"));m.style.display="block";a.uiUtil().offsetResize(q);window.onresize=function(){a.uiUtil().offsetResize(q);u&&u()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){var a=q.getElementsByTagName("p");if(0<a.length)for(var m=0;m<a.length;m++)"us-view-lbl-title"==a[m].id&&a[m].focus()},10)},hide:function(){m.style.display="none";q.style.display="none"},dispose:function(){window.onresize=function(){u&&u()};q.parentNode.parentNode.removeChild(q.parentNode);m.parentNode.removeChild(m);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};