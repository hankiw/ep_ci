var __certselect=function(a){var W=function(e){function x(){if(!a.certsList)return null;var c=a.certsList,b=c.list.length,g=[],d=[],h=e.args.dn,f=null;null!=a.ESVS.Policy&&(-1!=a.ESVS.Policy.indexOf("|")?f=a.ESVS.Policy.split("|"):(f=[],f[0]=a.ESVS.Policy));var l=null;null!=a.ESVS.Organization&&(-1!=a.ESVS.Organization.indexOf("|")?l=a.ESVS.Organization.split("|"):(l=[],l[0]=a.ESVS.Organization));for(var m=0;m<b;m++){a.usWebToolkit.x509Certificate.parser(c.list[m].cert,"Base64");var t=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),k=a.usWebToolkit.x509Certificate.getSubjectName(),n=a.usWebToolkit.x509Certificate.getNotAfter(),E=a.usWebToolkit.x509Certificate.getNotAfter(),p=c.list[m].index,D=a.certUtil().getIssuerName(t);"undefined"==D&&(D=a.certUtil().getO(k));if(null==h||k.toLowerCase()==h.toLowerCase()){if(null!=a.ESVS.Policy){for(var A=0;A<f.length&&f[A]!=t;A++);if(f.length<=A)continue}if(null!=a.ESVS.Organization&&("CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type||"CERT_REVOCATION"==e.type||"CERT_SOE"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type)){for(A=0;A<l.length&&l[A].toLowerCase()!=a.certUtil().getO(k).toLowerCase();A++);if(l.length<=A)continue}if(a.ESVS.ShowExpiredCerts||2!==a.certUtil().getExpirationStateValue(E))A=[""],A[1]=a.certUtil().getCertType(t),A[2]=a.certUtil().getCN(k),A[3]=D,A[4]=a.certUtil().getLocalDate(n),A[5]=p,A[6]=a.certUtil().getExpirationStateValue(E),"crosscert"==a.certUtil().getO(k).toLowerCase()?g.push(A):d.push(A)}}return{list:g.concat(d)}}function v(c,b,g,d,h){if(a.CONST.__USFB_M_DISK.device>c||0>b||!g)return-1;var f=0,l=0;w=b;a.certsList&&(a.certsList=null);k=!0;if(a.CONST.__PF_M_LS.device===c&&2&a.ESVS.Mode){a.PFSH||h(-1);try{a.PFSH.SelectStorage(1)}catch(D){h(-1)}try{a.PFSH.LoadAllCerts(document.domain)}catch(D){301E5===D.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}b=null;try{b=a.PFSH.GetUserCerts(document.domain),a.PFUC=b}catch(D){f=0}b&&(f=b.length-1);if(0<f){d=[];for(var n=0;n<f;n++){var t=n+1,u={};u.index=t;u.cert=b[t].signcert;d[n]=u}a.certsList={list:d}}else a.certsList=null,l=0;h(l)}else if(c==a.CONST.__PF_M_SS.device&&a.CCPFSH())k=!1,a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.BSPKI,function(b,c){0==b&&a.CCPFSH().GetCertificateList(function(b,c){if(0==b){var d=0;(a.PFUC=c)&&(d=c.length-1);if(0<d){for(var g=[],f=0;f<d;f++){var l=f+1,e={};e.index=l;e.cert=c[l].signcert;g[f]=e}a.certsList={list:g}}}h(b)})});else if(c==a.CONST.__PF_M_CLOUDSIGN.device){k=!1;if(e.CS_phoneNumber)E(e.CS_phoneNumber);else{var y=a.loadUI("phoneNumber")({type:"phoneNumber",args:null,onConfirm:function(a){O=a;E(a);y.dispose()},onCancel:function(){y.dispose();h(l)}});y.show()}var E=function(b){a.uiUtil().loadingBox(!0,"us-div-list-load",0);a.PFCS().reqMemberInfo(b,function(c,d,g){if(0!=c)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),alert(d+"\n\nError Code [ "+c+" ]"),!1;d=parseInt(g.split("|")[0]);if(0<d)p(b,h);else{if(-1==d){d=a.loadUI("cloudservice");var f=d({type:"double",args:{pNumber:b},onCancel:function(){f.dispose(!0);a.uiUtil().loadingBox(!1,"us-div-list-load",0);h(c)}})}else d=a.loadUI("cloudservice"),f=d({type:"joinus",args:{pNumber:b},onCancel:function(){f.dispose(!0);a.uiUtil().loadingBox(!1,"us-div-list-load",0);h(c)}});f.show()}})},p=function(b,c){a.PFCS().reqGetCert(b,"LOGIN",function(d,g,f){if("0021"==d)a.PFCS().reqGetCert(b,"LOGIN",function(b,d,g){if(0<g.length){d=[];for(var f=0;f<g.length;f++){var h={};h.index=f+1;h.cert=g[f];d[f]=h}a.certsList={list:d}}c(b)});else{if(0!=d)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.uiUtil().errMsgBox(g,d),c(d),!1;if(0<f.length){g=[];for(var h=0;h<f.length;h++){var e={};e.index=h+1;e.cert=f[h];g[h]=e}a.certsList={list:g}}c(d);return!0}})}}else!a.uiUtil().isItPFDevice(c)&&4&a.ESVS.Mode?a.CONST.__USFB_M_HDD.device!=c&&a.CONST.__USFB_M_DISK.device!=c||null==a.Whale()||!P?a.nimservice()?a.nimservice().GetAllUserCertListNum(c,b,d,function(b,d,e){if(m!=c)return!1;f=e;if(0==b)0<f?a.nimservice().GetAllUserCert(e,function(b,c){0==b?a.certsList={list:c}:win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-list-load");h(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),h(0));else{if(c==a.CONST.__USFB_M_MOBILE.device&&61E6==b)return a.ERROR.Code=11003,a.ERROR.Message=g.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(g.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cls-btn").click(),d="firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),null==d&&a.uiUtil().msgBox(g.IDS_MSGBOX_BLOCK_POPUP_WINDOW),a.certsList=null):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),h(0)),!1;if(c==a.CONST.__USFB_M_SECUREDISK.device&&8005E4==b)return a.ERROR.Code=31001,a.ERROR.Message=g.IDS_MSGBOX_NOT_INSTALL_SD,confirm(g.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(d="firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"),null==d&&a.uiUtil().msgBox(g.IDS_MSGBOX_BLOCK_POPUP_WINDOW)),a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),h(b),!1;-1!==f&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());h(b);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(a.uiUtil().msgBox(g.IDS_MSGBOX_NIM_ERROR_UNLOAD),h(-1)):a.Whale().getCerts(c,b,function(b,c,d){0==b?(a.certsList=0==d.length?null:{list:d},a.uiUtil().loadingBox(!1,"us-div-list-load")):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(c,b));h(b)}):h(l)}function F(c,b){if(!c||!b)return!1;if(!a.certsList||0>n.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var g=a.loadUI("certverify")({type:null,args:{idx:parseInt(n.selectedIndex())},onConfirm:function(){g.dispose();c.focus()},onCancel:function(){g.dispose();c.focus()}});g.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function G(c,b){if(!c||!b)return!1;if(!a.certsList||0>n.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var g=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(n.selectedIndex()),cert:a.certsList.list[parseInt(n.selectedIndex())-1].cert},onConfirm:function(){g.dispose();c.focus()},onCancel:function(){g.dispose();c.focus()}});g.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function la(c){if(!c)return!1;var b="https://raadmin.crosscert.com/customer/tk/Main.jsp?";if(4<=a.ESVS.Mode)if(a.nimservice()){var g=a.usWebToolkit.util.encode64(document.URL);a.nimservice().EncryptDataWithSymmKey("SEED","mOdFccVPHK7xnZYc",g,"utf-8",!1,function(c,g,f){0==c&&(b+="&Y3Jvc3NjZXJ0=",b+=f);"firefox"==a.browserName?window.open(b,"crosscert_url","scrollbars=1"):window.open(b)})}else"firefox"==a.browserName?window.open(b,"crosscert_url","scrollbars=1"):window.open(b);else"firefox"==a.browserName?window.open(b,"crosscert_url","scrollbars=1"):window.open(b);c.focus()}function ma(c){if(!c)return!1;var b=document.getElementById("us-div-cert-select");b.style.display="none";var g=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{style:"child"},onCancel:function(){g.dispose();b.style.display="block";var d=document.getElementById("us-div-cert-select");switch(m){case a.CONST.__USFB_M_DISK.device:X(d,r);break;case a.CONST.__USFB_M_MOBILE.device:Y(d,r);break;case a.CONST.__USFB_M_HDD.device:Z(d,r);break;case a.CONST.__PF_M_LS.device:aa(d,r);break;case a.CONST.__PF_M_SS.device:L(d,r);break;case a.CONST.__USFB_M_MOBILETOKEN.device:case a.CONST.__USFB_M_SECUREDISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__PF_M_CLOUDSIGN.device:break;default:N(d,r)}c.focus()}});g.show()}function ba(c,b,g,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!g||!d)return k=!1;var h=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(f){f=b.list[f-1].index;0<f?v(c,f,d,"",function(b){0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),n.redrawList(null,0)):(b=x())?n.redrawList(b.list,b.list.length):n.redrawList(null,0);k=!1;a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose();g.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")}):k=!1},onCancel:function(){k=!1;a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose();g.focus()}});h.show()}function na(c,b,g,d){if(a.CONST.__USFB_M_DISK.device>c||!g||!d)return k=!1;var h=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(f){var l=b.list[f-1].name;if(0==a.ESVS.IssueCertInBIOToken&&("CERT_RENEWAL_KMCERT"===e.type||"CERT_RENEWAL"===e.type||"CERT_RENEWAL_SIGN"===e.type||"CERT_REVOCATION"===e.type||"CERT_SOE"===e.type)&&c==a.CONST.__USFB_M_HSMKEY.device&&-1!=l.indexOf("BIO_"))return a.uiUtil().errMsgBox(d.IDS_CANT_ISSUECERT_BIOTOKEN,-1),k=!1;0<f?(a.ESVS.Embedded?setTimeout(function(){h.dispose()},10):h.dispose(),v(c,f,d,"",function(b){if(0!=b){switch(b){case 4812E4:case 4813E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b)}n.redrawList(null,0)}else(b=x())?n.redrawList(b.list,b.list.length):n.redrawList(null,0);k=!1;g.focus()})):k=!1},onCancel:function(){k=!1;h.dispose();g.focus()}});h.show()}function oa(c,b,g,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!g||!d)return k=!1;var h=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){h.dispose();a.nimservice()?a.nimservice().CheckSCardConnected(function(b,f){0===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();a.nimservice().CheckSCardPin(b,function(f,h){if(0!=f){switch(f){case 4904E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,f)}n.redrawList(null,0);k=!1;setTimeout(function(){g.focus()},10)}else v(c,0,d,b,function(b){0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),n.redrawList(null,0)):(b=x())?n.redrawList(b.list,b.list.length):n.redrawList(null,0);k=!1;setTimeout(function(){g.focus()},10)})})},onCancel:function(){k=!1;PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){g.focus()},10)}}),PINDialog.show()):(k=!1,a.uiUtil().msgBox(d.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){g.focus()},10))}):(k=!1,a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){g.focus()},10))},onCancel:function(){k=!1;h.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");g.focus()}});h.show()}function L(c,b){if(!c||!b)return k=!1;m=a.CONST.__PF_M_SS.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);"CERT_SELECT"!=e.type&&(J(b),B());a.uiUtil().loadingBox(!0,"us-div-list-load",0);setTimeout(function(){v(a.CONST.__PF_M_SS.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),k=!1;(c=x())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);k=!1})},0)}function aa(c,b){if(!c||!b)return k=!1;m=a.CONST.__PF_M_LS.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);"CERT_SELECT"!=e.type&&(J(b),B());a.uiUtil().loadingBox(!0,"us-div-list-load",0);setTimeout(function(){v(a.CONST.__PF_M_LS.device,0,b,"",function(c){a.uiUtil().loadingBox(!1,"us-div-list-load",0);if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),k=!1;(c=x())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);k=!1})},10)}function ca(c,b){if(!c||!b)return k=!1;m=a.CONST.__PF_M_CLOUDSIGN.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);J(b);da("123456789012345678901234567890");v(a.CONST.__PF_M_CLOUDSIGN.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),k=!1;(c=x())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);k=!1})}function Z(c,b){if(!c||!b)return k=!1;m=a.CONST.__USFB_M_HDD.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);J(b);B();v(a.CONST.__USFB_M_HDD.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),k=!1;(c=x())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);k=!1;return!0})}function X(c,b){if(!c||!b)return k=!1;k=!0;var g=null;m=a.CONST.__USFB_M_DISK.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);J(b);B();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))if(null!=a.Whale()&&P)a.Whale().getDiskList(function(d,h,f){h=0;f&&(h=f.length);if(0==d&&0<h){d=[];for(var e=0,m=0;e<h;e++)if("MacIntel"!=navigator.platform||"Macintosh HD"!=f[e]){var t={};t.index=e+1;t.name=f[e];d[m++]=t}g={list:d};k=!1}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,k=!1;ba(a.CONST.__USFB_M_DISK.device,g,c,b)});else if(a.nimservice())a.nimservice().GetDiskList(function(d,h,f){h=0;f&&(h=f.length);if(0==d&&0<h){d=[];for(var e=0,m=0;e<h;e++)if("MacIntel"!=navigator.platform||"Macintosh HD"!=f[e]){var t={};t.index=e+1;t.name=f[e];d[m++]=t}g={list:d}}else return a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,k=!1;k=!1;ba(a.CONST.__USFB_M_DISK.device,g,c,b)});else return k=!1,a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else k=!1;return!0}function W(c,b){if(!c||!b)return k=!1;k=!0;var g=null;m=a.CONST.__USFB_M_HSMKEY.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);pa(b);B();if(4&a.ESVS.Mode)if(a.nimservice()){var d=0;if("CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type||"CERT_REVOCATION"==e.type||"CERT_SOE"==e.type)d=1;a.nimservice().GetHSMList(d,function(d,f,e){f=0;e&&(f=e.length);if(0==d&&0<f){d=0;for(var h=[],l=0;l<f;l++){var m=l+1,n={},E=e[l].split("|");n.index=m;n.name=E[0];n.driver=E[1];n.passage=E[2];n.validity=E[3];h[d++]=n}g={list:h}}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.nimservice().GetLastErrorCode();k=!1;na(a.CONST.__USFB_M_HSMKEY.device,g,c,b)})}else return k=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else k=!1;return!0}function qa(c,b){if(!c||!b)return k=!1;m=a.CONST.__USFB_M_SECUREDISK.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);J(b);B();a.nimservice().IsSDInstalled(function(c,d){a.uiUtil().loadingBox(!1,"us-div-list-load");0!=c?(k=!1,a.ERROR.Code=31001,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SD,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW))):v(a.CONST.__USFB_M_SECUREDISK.device,1,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),k=!1;(c=x())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);k=!1;return!0})})}function ra(c,b){if(!c||!b)return k=!1;m=a.CONST.__USFB_M_MOBILETOKEN.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);J(b);B();if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().IsInstalledUSIMModule(2,!1,function(c,d){a.uiUtil().loadingBox(!1,"us-div-list-load");0==c?a.nimservice().SetUSIMOptions(a.usimEnv.sitecode,a.usimEnv.modecode,a.usimEnv.siteURL,a.usimEnv.serviceIP,a.usimEnv.servicePort,a.usimEnv.downloadURL,function(a){a=document.getElementById("us-confirm-btn");k=!1;a.click()}):(4847E4==c||4117E4==c?(a.ERROR.Code=21002,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SMARTCERT,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SMARTCERT)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):(n.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display="")):(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),n.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display=""),k=!1)});else return k=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else k=!1;return!0}function Y(c,b,g){if(!c||!b)return k=!1;var d=[function(){ca(c,b)},function(){a.ESVS._chkEXESetupCancel=!1;sa(c,b)}],e=a.loadUI("mobileselect")({type:null,args:null,onConfirm:function(a){d[a]();g&&g(a);e.dispose();c.focus()},onCancel:function(){k=!1;e.dispose();c.focus()}});e.show();return!0}function sa(c,b){if(!c||!b)return k=!1;m=a.CONST.__USFB_M_MOBILE.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);J(b);B();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))if(a.nimservice())v(m,w,b,"",function(c){if(0!=c){switch(c){case 61E6:case 6101E4:a.ERROR.Code=11003;a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_MOBILE;confirm(b.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)&&(c=document.getElementById("us-cls-btn"),k=!1,c.click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW));break;case 6102E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_LOAD_LIBRARY,c);break;case 6107E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_SET_ENV,c)}n.redrawList(null,0)}else(c=x())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);k=!1});else return k=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else k=!1;return!0}function N(c,b){if(!c||!b)return k=!1;k=!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function C(c){var b="browsersign";if(c==a.CONST.__PF_M_LS.device||c==a.CONST.__PF_M_SS.device)b="browsersign";else if(c==a.CONST.__PF_M_CLOUDSIGN.device)b="cloudsign";else{null!=K&&(K.dispose(),K=null);return}null!=K?K.changeMedia(b):setTimeout(function(){K=a.loadUI("guide")({type:b,onCancel:function(){K.dispose();K=null}});K.show()},10)}function J(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=r.IDS_PASSWORD_DESCRIPTION;return!0}function pa(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PIN));document.getElementById("us-lbl-pw2").innerHTML="";return!0}function da(c){if(null==c||0>=c.length)return!1;var b=document.getElementById("us-pw-text");b.value=c;b.readOnly=!0;b.disabled=!0;if(m==a.CONST.__PF_M_CLOUDSIGN.device||"CERT_SELECT"==e.type)document.getElementById("us-div-pw").style.display="none";return!0}function B(){m!=a.CONST.__PF_M_CLOUDSIGN.device&&(document.getElementById("us-div-pw").style.display="block");var c=document.getElementById("us-pw-text");c&&(c.value="",c.readOnly=!1,c.disabled=!1)}function ta(c,b,g){if(!c||!b||!g)return!1;var d=0,e={};try{var f=a.PFSH.SetP12OnMemory(c,b);d=f.index;a.PFUC=e=f.aluc}catch(l){switch(l.code){case 1E7:0<=l.detail.indexOf("115010")?a.uiUtil().msgBox(g.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(g.IDS_MSGBOX_COMMON_ERROR_GET_CERT,l.detail);break;default:a.uiUtil().errMsgBox(g.IDS_MSGBOX_COMMON_ERROR_GET_CERT,l.code)}return!1}a.certsList&&(a.certsList=null);c=[];b={};b.index=d;b.cert=e[d].signcert;c[0]=b;a.certsList={list:c};if(d=x())return n.redrawList(d.list,d.list.length),!0;a.certsList=null;n.redrawList(null,-1);B();return!1}function Q(){a.certsList&&(a.certsList=null);n.redrawList(null,-1);B();pw=""}function ea(c,b,e,d){(null==b||0>=b.length||null==e)&&d(-1);a.certsList&&(a.certsList=null);if(0<c)a.nimservice().GetSignCertFromCertList(c,function(e,g,h){g=[];var f={};0==e?(f.index=c,f.cert=h,g[0]=f,a.certsList={list:g},(e=x())?(n.redrawList(e.list,e.list.length),b="",d(0)):(Q(),d(-1))):(Q(),d(-1))});else{var g=a.nimservice().GetLastErrorCode();a.nimservice().GetLastErrorMessage();switch(g){case 4301E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g)}Q();d(-1)}}function ua(c,b,e,d){(null==c||0>=c.length||null==b||0>=b.length||null==e)&&d(-1);a.nimservice()?a.nimservice().GetPfxCertList(1,c,b,function(c,f,g){0==c?ea(g,b,e,function(c){0==c?d(0):d(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(f,c),Q(),d(0),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(e.IDS_MSGBOX_NIM_ERROR_UNLOAD),b="",d(-1))}function S(c,b,e,d){(null==c||0>=c.length||null==b||0>=b.length||null==e)&&d(-1);4<=a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m)?a.nimservice()?a.nimservice().GetPfxCertList(0,c,b,function(c,f,g){0==c?ea(g,b,e,function(c){0==c?d(0):d(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(f,c),Q(),d(-1),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(e.IDS_MSGBOX_NIM_ERROR_UNLOAD),d(-1)):(rv=ta(c,b,e),b="")}function q(){e.onConfirm=fa;T=!1}function va(c){function b(){ha++;if(ha>=a.ESVS.LimitNumOfTimesToTryToInputPW)if(a.ESVS.Embedded)a.bsUtil().AhnlabClearText("us-pw-text"),h.value="",setTimeout(function(){h.focus()},10);else{var b=d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER;a.uiUtil().msgBox(b);if("DIGITAL_SIGNATURE_P7"===e.type){var c=a.certsList.list[t-1].cert;(!c||0>=c.length)&&M();c=a.certUtil().getTheCertAttributes(c,"Base64");g(b,null,c,-1,"",m)}else M(!0)}else a.bsUtil().AhnlabClearText("us-pw-text"),h.value="",setTimeout(function(){h.focus()},10)}n.restoreOnMouseEvent();if(!c)return!1;var g=e.onConfirm;if(0==T)fa=e.onConfirm,T=!0;else return!1;e.onConfirm=function(){};var d=c,h=document.getElementById("us-pw-text"),f=h.value;if(m==a.CONST.__USFB_M_ETC.device&&("CERT_RENEWAL_KMCERT"===e.type||"CERT_RENEWAL"===e.type||"CERT_RENEWAL_SIGN"===e.type||"CERT_REVOCATION"===e.type||"CERT_SOE"===e.type))return a.uiUtil().errMsgBox(d.IDS_CANT_WORK_WITH_PFX,-1),q(),!1;f&&4&a.ESVS.Mode&&("touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()?f=a.bsUtil().GetEncryptPwd("us-keyboard-secure-frm","us-pw-text"):"ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()&&(f=a.bsUtil().GetAhnlabEncInputInfo("us-pw-text")));if(a.CONST.__USFB_M_MOBILETOKEN.device!=m&&(!a.certsList||0>n.selectedIndex()))return a.uiUtil().msgBox(d.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),h.value="",setTimeout(function(){h.focus()},10),q(),!1;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m)){var l=function(){var b=parseInt(n.selectedIndex());if("DIGITAL_SIGNATURE_P7"===e.type){var p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;var l=a.certUtil().getTheCertAttributes(p,"Base64");g(d.IDS_MSGBOX_SIGN_ERROR,p,l,b,f,m)}else if("DIGITAL_SIGNATURE_P7_EXT"===e.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type)g(d.IDS_MSGBOX_SIGN_ERROR,b,f,m,w);else if("DIGITAL_SIGNATURE_P7_XML"===e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(d.IDS_MSGBOX_SIGN_ERROR,l,b,f,m,p)}else if("DIGITAL_SIGNATURE_P1"===e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(p,"Base64");l=a.usWebToolkit.x509Certificate.getSubjectName();if(!l||0>=l.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-2),q(),!1;g(p,l,d.IDS_MSGBOX_SIGN_ERROR,b,f,m)}else if("CERT_RENEWAL"==e.type||"CERT_RENEWAL_KMCERT"==e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(p,"Base64");var k=a.usWebToolkit.x509Certificate.getNotAfter();if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;"CERT_RENEWAL"==e.type?g(k,c.IDS_CONFIRMBOX_CERT_RENEWAL,m,w,b,f):g(k,c.IDS_CONFIRMBOX_KMCERT_ISSUE,m,w,b,f)}else if("CERT_REVOCATION"==e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(d.IDS_CONFIRMBOX_CERT_REVOCATION,b,f,m,w,l)}else if("CERT_SOE"==e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(d.IDS_CONFIRMBOX_CERT_SOE,b,f,m,w,l)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===e.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==e.type){k={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(b,f,k,p,l,m);h.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(b,f,d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,l,m)}else if("ENCRYPT_P7"==e.type)g(b,f,d.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(b,f,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM",p,l,m)}else if("CERT_RENEWAL_SIGN"==e.type){p=a.certsList.list[b-1].cert;if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(p,"Base64");k=a.usWebToolkit.x509Certificate.getNotAfter();if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(k,c.IDS_CONFIRMBOX_CERT_RENEWAL,m,w,b,f,l)}else if("CERT_SELECT"===e.type){if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;l=a.certUtil().getTheCertAttributes(p,"Base64");g(d.IDS_MSGBOX_SIGN_ERROR,p,l,b,"",m,O)}else g()};if(null==a.Whale()&&!a.nimservice())return q(),!1;if(a.CONST.__USFB_M_MOBILETOKEN.device==m){if("DIGITAL_SIGNATURE_P7"===e.type)g(d.IDS_MSGBOX_SIGN_ERROR,null,null,-1,"",m);else if("DIGITAL_SIGNATURE_P7_EXT"===e.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type)g(d.IDS_MSGBOX_SIGN_ERROR,-1,"",m,w);else if("DIGITAL_SIGNATURE_P1"===e.type)g(null,"",d.IDS_MSGBOX_SIGN_ERROR,-1,"",m);else if("CERT_RENEWAL"==e.type)g("",c.IDS_CONFIRMBOX_CERT_RENEWAL,m,w,-1,"");else if("CERT_RENEWAL_KMCERT"==e.type)g("",c.IDS_CONFIRMBOX_KMCERT_ISSUE,m,w,-1,"");else if("CERT_RENEWAL_SIGN"==e.type)g("",c.IDS_CONFIRMBOX_CERT_RENEWAL,m,w,-1,"",null);else if("CERT_REVOCATION"==e.type)g(d.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",m,w);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===e.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"===e.type){var k={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};g(-1,"",k,null,null,m)}else"DIGITAL_SIGNATURE_P7_FILE"===e.type?g(-1,"",d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,m):"ENCRYPT_P7"==e.type?g(-1,f,d.IDS_MSGBOX_ENCRYPT_ERROR):"VID_VERIFICATION"===e.type?g(-1,"",d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM"):"DIGITAL_SIGNATURE_P7_XML"===e.type?g(d.IDS_MSGBOX_SIGN_ERROR,null,-1,"",m,null):"CERT_SOE"==e.type?g(d.IDS_CONFIRMBOX_CERT_SOE,-1,"",m,w):"ENCRYPT_P7"==e.type?g(-1,"",d.IDS_MSGBOX_ENCRYPT_ERROR):g();h.value="";a.ESVS.Embedded&&B();return!0}var t=parseInt(n.selectedIndex());if(a.CONST.__USFB_M_HDD.device!=m&&a.CONST.__USFB_M_DISK.device!=m||null==a.Whale()||!P){if("MPKI"==a.ESVS.PKI||m==a.CONST.__USFB_M_ETC.device||m==a.CONST.__USFB_M_HSMKEY.device||"CERT_RENEWAL"!=e.type&&"CERT_RENEWAL_SIGN"!=e.type&&"CERT_RENEWAL_KMCERT"!=e.type&&"CERT_REVOCATION"!==e.type&&"CERT_SOE"!==e.type&&"DIGITAL_SIGNATURE_P1"!==e.type&&"DIGITAL_SIGNATURE_P7"!==e.type&&"DIGITAL_SIGNATURE_P7_EXT"!=e.type&&"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"!=e.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==e.type&&"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"!==e.type&&"VID_VERIFICATION"!==e.type)l();else{if(!f||0>=f.length)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){h.focus()},10),q(),!1;"DIGITAL_SIGNATURE_P1"!=e.type&&"DIGITAL_SIGNATURE_P7"!=e.type&&"DIGITAL_SIGNATURE_P7_EXT"!=e.type?a.nimservice().CheckPassword(m,w,t,f,function(c,e){if(0==c)return l(),h.value="",a.ESVS.Embedded&&B(),!0;q();"Enabled"===a.ESVS.UniCRS?a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED_URS,c):a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED,c);b();a.uiUtil().loadingBox(!1,"us-div-list-load")}):l()}h.value="";a.ESVS.Embedded&&B();return!0}if(!f||0>=f.length)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){h.focus()},10),q(),!1;var u=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00"));a.Whale().getSignDataP7(u,t,f,!0,function(c,e,f){if(0!=c)a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),q(),b();else return l(),h.value="",a.ESVS.Embedded&&B(),!0})}else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(m)){if(!f&&m!=a.CONST.__PF_M_CLOUDSIGN.device&&"CERT_SELECT"!=e.type)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){h.focus()},10),q(),!1;if(m==a.CONST.__PF_M_CLOUDSIGN.device||"CERT_SELECT"==e.type)y=!0;else{if(!a.PFUC)return q(),!1;t=parseInt(n.selectedIndex());u=null;try{u=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[t].signpri)}catch(E){}var y=!1;try{y=a.usWebToolkit.pkcs8.checkUserCertPassword(u,f)}catch(E){}finally{u=""}}if(!1===y)a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),q(),b();else{u=null;t=parseInt(n.selectedIndex());u=m==a.CONST.__PF_M_CLOUDSIGN.device?a.certsList.list[t-1].cert:a.PFUC[t].signcert;if("DIGITAL_SIGNATURE_P7"===e.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;y=a.certUtil().getTheCertAttributes(u,"Base64");g(d.IDS_MSGBOX_SIGN_ERROR,u,y,t,f,m,O)}else if("CERT_SELECT"===e.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;y=a.certUtil().getTheCertAttributes(u,"Base64");g(d.IDS_MSGBOX_SIGN_ERROR,u,y,t,"",m,O)}else if("DIGITAL_SIGNATURE_P1"===e.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;y=a.certUtil().getTheCertAttributes(u,"Base64");g(u,y.subjectName,d.IDS_MSGBOX_SIGN_ERROR,t,f,m,O)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"==e.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==e.type){k={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;y=a.certUtil().getTheCertAttributes(u,"Base64");g(t,f,k,u,y,m)}else if("CERT_RENEWAL"==e.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(u,"Base64");k=a.usWebToolkit.x509Certificate.getNotAfter();if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;g(k,d.IDS_CONFIRMBOX_CERT_RENEWAL,m,w,t,f)}else if("CERT_RENEWAL_SIGN"==e.type){if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(u,"Base64");k=a.usWebToolkit.x509Certificate.getNotAfter();if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;y=a.certUtil().getTheCertAttributes(u,"Base64");g(k,c.IDS_CONFIRMBOX_CERT_RENEWAL,m,w,t,f,y)}else"CERT_REVOCATION"===e.type?g(d.IDS_CONFIRMBOX_CERT_REVOCATION,t,f,m,w):"VID_VERIFICATION"===e.type?a.CONST.__PF_M_CLOUDSIGN.device==m?g(t,f,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"CLOUDSIGN"):g(t,f,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS"):g();h.value="";a.ESVS.Embedded&&B();return!0}}return!1}function wa(c,b,e){if(!c||!b)return!1;ia=a.loadUI("gridlist");n=ia({type:"certslist",tblid:"us-tbl-list",tbltitleid:"us-tbl-list-th",titlelistid:"us-grid-head-div",titlerowid:"us-list-title-row",titleelementid:"us-list-title-element",titledividerid:"us-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-tbl-list-td",datalistid:"us-grid-body-div",datarowid:"us-list-body-row",dataelementid:"us-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element",textObj:b});e=!0;"opera"==a.browserName&&(e=!1);n.drawList(c,c.length,null,0,ja,e);v(m,w,b,"",function(c){0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=x())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);k=!1})}function I(c){if(!c)return!1;R(c,r,"close");for(var b=a.ESVS.Media.list.split("|"),e=0;e<b.length;e++){var d=a.CONST.medias[b[e]];if(void 0!=d&&null!=d){var h=document.getElementById("us-btn-"+d.name);if(void 0!=h&&null!=h&&"us-layout-storage-btn-none"!=h.className)if(c===h){var f=document.getElementById("us-cert-get-btn");f&&(d.device!=a.CONST.__USFB_M_HDD.device&&d.device!=a.CONST.__PF_M_LS.device&&d.device!=a.CONST.__PF_M_SS.device&&d.device!=a.CONST.__USFB_M_DISK.device?(f.style.display="none",f.style.visibility="hidden"):(f.style.display="block",f.style.visibility="visible"));h.className="us-layout-storage-btn-on"}else h.className="us-layout-storage-btn-off"}}return!0}function xa(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);0==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;b=document.getElementById("us-storage-btn-list");var e=document.createElement("li");e.setAttribute("id","us-storage-btn-li-"+c.name,0);e.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(e.className="line-first");"hidden"===c.visibility?(e.style.display="none",e.style.visibility="hidden"):(e.style.display="block",e.style.visibility="visible");var d=document.createElement("button");d.setAttribute("type","button",0);d.setAttribute("id","us-btn-"+c.name,0);d.setAttribute("title",c.label,0);d.setAttribute("tabindex",c.tabIndex,0);c.disabled?(d.onclick=function(){a.uiUtil().msgBox(r.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},d.className="us-layout-storage-btn-none"):(d.onclick=c.onclick,d.className=c.device===m?"us-layout-storage-btn-on":"us-layout-storage-btn-off");e.appendChild(d);if(!a.ESVS.chkEXESetup&&"cloudsign"!==c.name&&"webstorage"!==c.name&&"browsersign"!==c.name&&(c.device!=a.CONST.__USFB_M_DISK.device&&c.device!=a.CONST.__USFB_M_HDD.device||null==a.Whale()||!P)){var h=document.createElement("span");h.className="us-download-select";d.appendChild(h)}h=document.createElement("span");h.className="us-img-storage";var f=document.createElement("img");f.setAttribute("id","us-img-"+c.name,0);f.setAttribute("alt",c.label,0);"browsersign"==c.name?"unknown"==a.browserName?c.disabled?f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0):c.disabled?f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/browser/"+a.browserName+"_d.png",0):f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/browser/"+a.browserName+".png",0):c.disabled?f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):f.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);h.appendChild(f);d.appendChild(h);h=document.createElement("span");h.setAttribute("id","us-lbl-"+c.name,0);h.className="us-layout-lbl-storage";h.appendChild(document.createTextNode(c.label));d.appendChild(h);e.appendChild(d);b.appendChild(e);return!0}function R(c,b,e){if("no_more"==e)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{document.getElementById("us-storage-wrap")&&("open"==e?(c=document.getElementById("us-div-storage"),c.style.height="186px",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){R(this,b,"close")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c=document.getElementById("us-div-storage"),c.style.height="96px",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){R(this,b,"open")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0)));c=a.ESVS.Media.list.split("|");for(var d=0;d<c.length;d++){var h=a.CONST.medias[c[d]];if(void 0!=h&&null!=h){var f=document.getElementById("us-storage-btn-li-"+h.name);if(void 0!=f&&null!=f){var g=f.getAttribute("mediaIndex");"open"==e?(f.style.display="block",f.style.visibility="visible"):6<g?(f.style.display="none",f.style.visibility="hidden"):(f.style.display="block",f.style.visibility="visible");1==g&&document.getElementById("us-btn-"+h.name)}}}}return!0}function M(c){a.ESVS._chkEXESetupCancel=!0;n.restoreOnMouseEvent();m==a.CONST.__PF_M_CLOUDSIGN.device&&a.PFCS().reqCloseSession();if(c)e.onCancel(!0);else e.onCancel()}var ya=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+(a.ESVS.Embedded?"unisignweb/rsrc/layout/certselect_embedded.html?version="+a.ver:"unisignweb/rsrc/layout/certselect.html?version="+a.ver),!1);c.send(null);return c.responseText},ka=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certselect_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},r=a.CustomEval(ka,!0),ia=null,n=null,ha=0,z=a.ESVS.TabIndex+1,ja=0,m=a.CONST.__USFB_M_HDD.device,w=0,P=!1,O=null,k=!1,K=null;if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){m=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice);a.uiUtil().isItPFDevice(m)&&4==a.ESVS.Mode&&(a.SELECTINFO.curdevice=m=a.CONST.__USFB_M_HDD.device);if(m==a.CONST.__USFB_M_SECUREDISK.device||m==a.CONST.__USFB_M_SMARTCARD.device||m==a.CONST.__USFB_M_DISK.device)w=1;a.SELECTINFO.curdevice=m}else 2==a.ESVS.Mode&&(m=a.CONST.__PF_M_LS.device,a.SELECTINFO.curdevice=m);var U=null,V=null;window.FileReader?(U=function(c,b){if(null==c)return!1;a.uiUtil().loadingBox(!0,"us-div-list-load");if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else{var e=document.getElementById("us-confirm-btn"),d=document.getElementById("us-cert-search-btn"),h=a.loadUI("importcert")({type:"searchpfx",args:null,onConfirm:function(b,g,k){h.dispose();"MPKI"==a.ESVS.PKI?k?V(a.CONST.__USFB_M_HDD.device,0,b,g):S(b,g,c,function(a){g="";0===a?setTimeout(function(){e.focus()},10):setTimeout(function(){d.focus()},10)}):k?(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(c,d){SSDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");V(c,d,b,g)},onCancel:function(){pw="";SSDialog.dispose();S(b,g,c,function(a){g="";0===a?setTimeout(function(){e.focus()},10):setTimeout(function(){d.focus()},10)})}}),SSDialog.show()):S(b,g,c,function(a){g="";if(0===a){var b=document.getElementById("us-confirm-btn");setTimeout(function(){b.focus()},10)}else{var c=document.getElementById("us-cert-search-btn");c&&setTimeout(function(){c.focus()},10)}})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_IMPORT_CANCEL);h.dispose();setTimeout(function(){d.focus()},10)}});h.show()}return!0},V=function(c,b,g,d){function h(){var a=x();a?n.redrawList(a.list,a.list.length):n.redrawList(null,0)}function f(b,c,d,e){0===b&&m===c&&w===d&&(a.CONST.__USFB_M_SMARTCARD.device===m&&0===w&&v(m,w,r,e,function(a){(a=x())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);k=!1}),v(m,w,r,"",function(a){(a=x())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);k=!1}))}var l=d;document.getElementById("us-cert-get-btn");if(c==a.CONST.__PF_M_LS.device){var q=0;try{a.PFSH.LoadAllCerts(document.domain)}catch(D){301E5===D.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}try{var t=a.PFSH.SetP12OnMemory(g,l),u=t.aluc[t.index];a.usWebToolkit.x509Certificate.parser(u.signcert,"Base64");var y=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),E=a.certUtil().getIssuerEnName(y);a.PFSH.SaveUserCert(E,u,document.domain,!0)}catch(D){switch(q=D.code,D.code){case 1E7:0<=D.detail.indexOf("115010")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,D.detail);break;default:a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,D.code)}}f(q,c,b,"")}else if(c==a.CONST.__PF_M_SS.device){var p=function(d,e){a.CCPFSH().SetP12OnMemory(d,e,function(d,g,h){if(0==d)d=h.aluc[h.index],a.usWebToolkit.x509Certificate.parser(d.signcert,"Base64"),h=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),h=a.certUtil().getIssuerEnName(h),a.CCPFSH().SaveUserCert(h,d,!0,function(d){e="";0==d?f(d,c,b,""):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,g)});else{switch(d){case 1E7:0<=g.indexOf("115010")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,g);break;default:a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}e=""}})};a.CCPFSH().IsCCPFSHAvailable(function(b){a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.BSPKI,function(a,b){0==a&&p(g,l)})})}else a.CONST.__USFB_M_HSMKEY.device===c||a.CONST.__USFB_M_SMARTCARD.device===c?(q=null,q=a.CONST.__USFB_M_SMARTCARD.device===c?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN",PINDialog=a.loadUI("pin")({type:q,args:null,onConfirm:function(l){a.nimservice().ImportCert(0,g,d,c,b,l,function(d,g){if(0==d)m==c&&w==b&&c!=a.CONST.__USFB_M_MOBILE.device?f(d,c,b,l):(h(),a.uiUtil().msgBox(r.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),e.args&&3==e.args.type&&M();else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),d){case 4823E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:g=a.nimservice().GetLastErrorMessage();g=r.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+g;a.uiUtil().msgBox(g);break;case 4019E4:a.uiUtil().errMsgBox(g,d);break;case 4301E4:0<=g.indexOf("3509")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,g);break;default:switch(d=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),d){case 3509:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(g?g:r.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}}});PINDialog.dispose()},onCancel:function(){l="";PINDialog.dispose()}}),PINDialog.show()):a.nimservice().ImportCert(0,g,d,c,b,"",function(d,g){if(0==d)m==c&&w==b&&c!=a.CONST.__USFB_M_MOBILE.device?f(d,c,b,""):(h(),a.uiUtil().msgBox(r.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),e.args&&3==e.args.type&&M();else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),d){case 4823E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:g=a.nimservice().GetLastErrorMessage();g=r.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+g;a.uiUtil().msgBox(g);break;case 4019E4:a.uiUtil().errMsgBox(g,d);break;case 4301E4:0<=g.indexOf("3509")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,g);break;default:switch(d=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),d){case 3509:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(g?g:r.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}}})}):(U=function(c,b){if(null==c)return!1;b=document.getElementById("us-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(c.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))b.style.display="block";"safari"==a.browserName&&b.setAttribute("accept","",0);b.value="";if(""!=b.value){c=b.onchange;var e=b.parentNode;e.removeChild(b);b=document.createElement("input");b.setAttribute("type","file",0);"safari"==a.browserName?b.setAttribute("accept","",0):b.setAttribute("accept","application/x-pkcs12",0);b.setAttribute("id","us-file-search-hidden",0);b.className="us-layout-file-search-hidden";b.onchange=c;e.appendChild(b)}b.click();return!0},ImportPFX=function(c,b){function g(b,c,d,e){a.uiUtil().msgBox(h.IDS_MSGBOX_CERT_IMPORT_SUCCESS);a.CONST.__USFB_M_SMARTCARD.device===m&&1===w?v(m,w,h,e,function(a){(a=x())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);k=!1}):v(m,w,h,"",function(a){(a=x())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);k=!1})}function d(b,c,d,l,k){function p(d){var k=0,p=null;null!=f&&(k=1,p=f);a.nimservice().ImportCert(k,p,l,b,c,d,function(f,k){if(0==f)m==b&&w==c&&b!=a.CONST.__USFB_M_MOBILE.device?g(f,b,c,d):((f=x())?n.redrawList(f.list,f.list.length):n.redrawList(null,0),a.uiUtil().msgBox(h.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),e.args&&3==e.args.type&&M(),l=d="";else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),f){case 4823E4:a.uiUtil().msgBox(h.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(h.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(h.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(h.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(h.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(h.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:f=a.nimservice().GetLastErrorMessage();f=h.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+f;a.uiUtil().msgBox(f);break;case 4019E4:a.uiUtil().errMsgBox(k,f);break;default:switch(f=a.CONST.__PF_M_LS.device===b?f:a.nimservice().GetLastErrorCode(),f){case 3509:a.uiUtil().msgBox(h.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(h.IDS_MSGBOX_CERT_IMPORT_ERROR,f)}}})}var t=document.getElementById("us-cert-manage-get-cert-btn");if(4<=a.ESVS.Mode)if(a.CONST.__PF_M_LS.device==b||a.CONST.__PF_M_SS.device==b){if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;d=0;try{var u=a.PFSH.SetP12OnMemory(null,l),r=u.index,q=u.aluc[r];a.usWebToolkit.x509Certificate.parser(q.signcert,"Base64");var y=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),v=a.certUtil().getIssuerEnName(y);a.PFSH.SaveUserCert(v,q,document.domain,!0)}catch(H){switch(d=H.code,H.code){case 1E7:0<=H.detail.indexOf("115010")?a.uiUtil().msgBox(h.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(h.IDS_MSGBOX_CERT_IMPORT_ERROR,H.detail);break;default:a.uiUtil().errMsgBox(h.IDS_MSGBOX_CERT_IMPORT_ERROR,H.code)}}0==d&&g(d,b,c,"");l="";k&&k.dispose();setTimeout(function(){t.focus()},10)}else a.nimservice()?a.CONST.__USFB_M_HSMKEY.device===b||a.CONST.__USFB_M_SMARTCARD.device===b?(k&&k.dispose(),k=null,k=a.CONST.__USFB_M_SMARTCARD.device===b?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN",PINDialog=a.loadUI("pin")({type:k,args:null,onConfirm:function(a){p(a);PINDialog.dispose();setTimeout(function(){t.focus()},10)},onCancel:function(){l="";PINDialog.dispose();setTimeout(function(){t.focus()},10)}}),PINDialog.show()):(k&&k.dispose(),p("")):a.uiUtil().msgBox(h.IDS_MSGBOX_NIM_ERROR_UNLOAD);else{if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;d=0;try{u=a.PFSH.SetP12OnMemory(null,l),r=u.index,q=u.aluc[r],a.usWebToolkit.x509Certificate.parser(q.signcert,"Base64"),y=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),v=a.certUtil().getIssuerEnName(y),a.PFSH.SaveUserCert(v,q,document.domain,!0)}catch(H){switch(d=H.code,H.code){case 1E7:0<=H.detail.indexOf("115010")?a.uiUtil().msgBox(h.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(h.IDS_MSGBOX_CERT_IMPORT_ERROR,H.detail);break;default:a.uiUtil().errMsgBox(h.IDS_MSGBOX_CERT_IMPORT_ERROR,H.code)}}0==d&&g(d,b,c,"");l="";k&&k.dispose();setTimeout(function(){t.focus()},10)}}if(!c||!b)return!1;m=a.CONST.__USFB_M_ETC.device;w=0;var h=b,f=null;document.getElementById("us-confirm-btn");var l=document.getElementById("us-cert-search-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if("msie"==a.browserName&&8===parseInt(a.browserVersion))b=document.getElementById("us-div-cert-select"),b.onselectstart=function(){return!0},c.select(),f=c.value,c.style.display="none",b.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(f=c.value,-1<f.indexOf("fakepath"))return a.uiUtil().msgBox(h.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){l.focus()},10),!1}else f=c.value;if(0==IsPFX(f,h))return setTimeout(function(){l.focus()},10),!1;var r=a.loadUI("confirm")({type:null,args:{msg:h.IDS_MSG_SAVE_CERT},onConfirm:function(){r.dispose();Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){Dialog.dispose();"MPKI"==a.ESVS.PKI?d(a.CONST.__USFB_M_HDD.device,0,f,b,null):(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(a,c){d(a,c,f,b,SSDialog)},onCancel:function(){b="";SSDialog.dispose();setTimeout(function(){certGetBtn.focus()},10)}}),SSDialog.show())},onCancel:function(){Dialog.dispose();setTimeout(function(){certGetBtn.focus()},10)}});Dialog.show()},onCancel:function(){r.dispose();Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){Dialog.dispose();"MPKI"==a.ESVS.PKI?d(a.CONST.__USFB_M_HDD.device,0,f,b,null):null!=f?(Dialog.dispose(),ua(f,b,h,function(a){b="";if(0===a){var c=document.getElementById("us-confirm-btn");setTimeout(function(){c.focus()},10)}else{var d=document.getElementById("us-cert-search-btn");d&&setTimeout(function(){d.focus()},10)}})):(Dialog.dispose(),S(null,b,h,function(a){b="";if(0===a){var c=document.getElementById("us-confirm-btn");setTimeout(function(){c.focus()},10)}else{var d=document.getElementById("us-cert-search-btn");d&&setTimeout(function(){d.focus()},10)}}))},onCancel:function(){Dialog.dispose();setTimeout(function(){certGetBtn.focus()},10)}});Dialog.show()}});r.show();return!0});var T=!1,fa=null;return function(){var c=a.CustomEval(ya),b=a.CustomEval(ka,!0);a.ESVS.TargetObj.innerHTML=c();e.args.device&&a.uiUtil().isValidDevice(e.args.device)&&(m=e.args.device,w=e.args.drive);!0===e.args.possibleWhale&&(P=!0);var g=document.getElementById("us-lbl-title");a.ESVS.Embedded?(c=document.getElementById("us-lbl-title"),c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION+" "+b.IDS_CERT_SELECTION_PURPOSE_SIGN)),c.setAttribute("tabindex",z++,0),document.getElementById("us-cursor-disabled").setAttribute("tabindex",z++,0)):(g.appendChild(document.createTextNode(b.IDS_CERT_SELECTION)),g.setAttribute("tabindex",z++,0),g.setAttribute("title",b.IDS_SENSE_READER_INTRO,0),c=document.getElementById("us-cls-img-btn"),c.setAttribute("title",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0),c.onclick=function(){k&&a.ESVS.chkEXESetup||M()},document.getElementById("us-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0),c=document.getElementById("us-logo-img"),c.setAttribute("alt",b.IDS_LOGO,0),null!=a.options.logo?c.setAttribute("src",a.options.logo,0):c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0),c=document.getElementById("us-legend-storage"),c.appendChild(document.createTextNode(b.IDS_STORAGE_SELECT)));c=0;for(var d=a.ESVS.Media.list.split("|"),h=0;h<d.length;h++){var f=d[h],l=a.CONST.medias[f];if(void 0!=l&&null!=l){switch(l.device){case a.CONST.__USFB_M_DISK.device:l.label=b.IDS_STORAGE_REMOVABLE;l.disabled=2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_DISK.device),a.ESVS._chkEXESetupCancel=!1,X(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__USFB_M_DISK.device)};break;case a.CONST.__USFB_M_HSMKEY.device:l.label=b.IDS_STORAGE_SECTOKEN;l.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_HSMKEY.device),a.ESVS._chkEXESetupCancel=!1,W(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__USFB_M_HSMKEY.device)};break;case a.CONST.__USFB_M_SMARTCARD.device:l.label=b.IDS_STORAGE_SAVETOKEN;l.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;l.onclick=function(){if(!k||!a.ESVS.chkEXESetup){C(a.CONST.__USFB_M_SMARTCARD.device);a.ESVS._chkEXESetupCancel=!1;if(this&&b){k=!0;m=a.CONST.__USFB_M_SMARTCARD.device;w=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);J(b);B();var c=[];var d={};d.index=a.CONST.__USFB_M_SMARTCARD.device;d.name=b.IDS_SAVETOKEN_SMART_CARD;c[0]=d;c={list:c};k=!1;oa(a.CONST.__USFB_M_SMARTCARD.device,c,this,b)}else k=!1;I(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_SMARTCARD.device}};break;case a.CONST.__USFB_M_MOBILE.device:l.label=b.IDS_STORAGE_MOBILEPHONE;l.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||e.type&&("CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type||"CERT_REVOCATION"==e.type||"CERT_SOE"==e.type);l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_MOBILE.device),Y(this,b,function(b){a.SELECTINFO.curdevice="cloudsign"==b?a.CONST.__PF_M_CLOUDSIGN.device:a.CONST.__USFB_M_MOBILE.device}),I(this))};break;case a.CONST.__USFB_M_HDD.device:l.label=b.IDS_STORAGE_HARDDISK;l.disabled=2==a.ESVS.Mode;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_HDD.device),a.ESVS._chkEXESetupCancel=!1,Z(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__USFB_M_HDD.device)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:l.label=b.IDS_STORAGE_MOBILETOKEN;l.disabled="CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type?!0:"win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||e.type&&("DIGITAL_SIGNATURE_P7_EXT"==e.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type);l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_MOBILETOKEN.device),a.ESVS._chkEXESetupCancel=!1,document.getElementById("us-div-cert-select").style.display="none",ra(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__USFB_M_MOBILETOKEN.device)};break;case a.CONST.__USFB_M_SECUREDISK.device:l.label=b.IDS_STORAGE_SECUREDISK;l.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_SECUREDISK.device),a.ESVS._chkEXESetupCancel=!1,qa(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__USFB_M_SECUREDISK.device)};break;case a.CONST.__PF_M_LS.device:l.label=b.IDS_STORAGE_LS;l.disabled=1==a.ESVS.Mode||"CERT_SOE"==e.type||"CERT_REVOCATION"==e.type||"CERT_RENEWAL_KMCERT"==e.type;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_LS.device),a.ESVS._chkEXESetupCancel=!0,aa(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__PF_M_LS.device)};break;case a.CONST.__PF_M_SS.device:l.label=b.IDS_STORAGE_SS;l.disabled=1==a.ESVS.Mode||"CERT_SOE"==e.type||"CERT_REVOCATION"==e.type||"CERT_RENEWAL_KMCERT"==e.type;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_SS.device),a.ESVS._chkEXESetupCancel=!0,L(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__PF_M_SS.device)};break;case a.CONST.__PF_M_TOUCHSIGN.device:l.label=b.IDS_STORAGE_TOUCHSIGN;l.disabled=!0;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_TOUCHSIGN.device),a.ESVS._chkEXESetupCancel=!1,N(this,b),a.SELECTINFO.curdevice=a.CONST.__PF_M_TOUCHSIGN.device)};break;case a.CONST.__PF_M_SMARTSIGN.device:l.label=b.IDS_STORAGE_SMARTSIGN;l.disabled=!0;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_SMARTSIGN.device),a.ESVS._chkEXESetupCancel=!1,N(this,b),a.SELECTINFO.curdevice=a.CONST.__PF_M_SMARTSIGN.device)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:l.label=b.IDS_STORAGE_WEBSECTOKEN;l.disabled=!0;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_WEBSECTOKEN.device),a.ESVS._chkEXESetupCancel=!1,N(this,b),a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSECTOKEN.device)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:l.label=b.IDS_STORAGE_WEBSOFTTOKEN;l.disabled=!0;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_WEBSOFTTOKEN.device),a.ESVS._chkEXESetupCancel=!1,N(this,b),a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSOFTTOKEN.device)};break;case a.CONST.__PF_M_CLOUDSIGN.device:l.label=b.IDS_STORAGE_CLOUDSIGN;l.disabled=1==a.ESVS.Mode;l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_CLOUDSIGN.device),a.ESVS._chkEXESetupCancel=!0,ca(this,b),I(this),a.SELECTINFO.curdevice=a.CONST.__PF_M_CLOUDSIGN.device)};break;default:l.label=b.IDS_STORAGE_ETC,l.disabled=!0,l.onclick=function(){k&&a.ESVS.chkEXESetup||(C(0),a.ESVS._chkEXESetupCancel=!1,N(this,b),a.SELECTINFO.curdevice=0)}}a.ESVS.Media.option&&0>=a.ESVS.Media.option&&-1*a.ESVS.Media.option&Math.pow(2,h)&&a.ESVS.Media.defaultdevice!=f&&(l.disabled=!0);l.tabIndex=z;l.mediaIndex=c+1;l.visibility=6<l.mediaIndex?"hidden":"visible";xa(l)&&(z++,c++)}}d=document.getElementById("us-storage-more-btn");null!=d&&void 0!=d&&(d.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<c?(d.style.display="block",d.style.visibility="visible",d.setAttribute("tabindex",z++,0),d.onclick=function(){R(this,b,"open")}):(d.setAttribute("disabled","disabled",0),d.style.display="none",d.style.visibility="hidden",d.onclick=function(){R(this,b,"no_more")}),c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-h5-storage").innerText=b.IDS_H5_STORAGE;document.getElementById("us-h5-list").innerText=b.IDS_H5_LIST;c=document.getElementById("us-tbl-list");c.style.summary=b.IDS_CERT_LIST_TABLE_SUMMARY;c.setAttribute("title",b.IDS_CERT_LIST_CAPTION);a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var r=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];ja=z++;setTimeout(function(){wa(r,b,e.args.list)},100);document.getElementById("us-lbl-pw").appendChild(document.createTextNode(b.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=b.IDS_PASSWORD_DESCRIPTION;document.getElementById("us-file-search-hidden").onchange=function(){ImportPFX(this,b)};c=document.getElementById("us-cert-search-btn");c.setAttribute("value",b.IDS_CERT_SEARCH,0);c.onclick=function(){U(b)};if("CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type)c.style.display="none",c.style.visibility="hidden";a.uiUtil().addCapsLockEvent("us-pw-text","us-err-msg-capslock",b.IDS_MSGBOX_CAPSLOCK_ON,null);var t=document.getElementById("us-pw-text");t.onkeydown=function(a){if(a=a?a:event)a=a||window.event,13==(a.which||a.keyCode)&&document.getElementById("us-confirm-btn").click()};t.onkeyup=function(a){a.getModifierState&&(a.getModifierState("CapsLock")?(document.getElementById("us-err-msg-capslock").style.top=t.offsetTop+0+30+"px",document.getElementById("us-err-msg-capslock").style.display="block"):document.getElementById("us-err-msg-capslock").style.display="none")};t.onfocus=function(a){"block"==document.getElementById("us-err-msg-capslock").style.display&&(document.getElementById("us-err-msg-capslock").style.top=t.offsetTop+0+30+"px")};t.value="";t.setAttribute("title",b.IDS_PASSWORD_LABEL+b.IDS_PASSWORD_DESCRIPTION);a.ESVS.Embedded||(document.getElementById("enabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />');"MPKI"==a.ESVS.PKI&&(d=document.getElementById("us-lbl-pw"),h=document.getElementById("us-lbl-pw2"),d.disabled=!0,h.disabled=!0,t.readOnly=!0,t.disabled=!0);l=document.getElementById("us-confirm-btn");l.setAttribute("value",b.IDS_CONFIRM,0);l.onclick=function(){va(b)};if(d=document.getElementById("us-cert-verify-btn"))d.setAttribute("value",b.IDS_CERT_VERIFY,0),d.onclick=function(){F(this,b)};h=document.getElementById("us-cert-view-btn");h.setAttribute("value",b.IDS_CERT_VIEW,0);h.onclick=function(){G(this,b)};f=document.getElementById("us-cert-proposal-btn");f.setAttribute("value",b.IDS_CERT_PROPOSAL,0);f.setAttribute("title",b.IDS_LINK_TITLE,0);f.onclick=function(){la(this)};if(0==a.ESVS.CertRequestPageEnable||"MPKI"==a.ESVS.PKI)f.readOnly=!0,f.disabled=!0;document.getElementById("us-cert-get-btn");var u=document.getElementById("us-cls-btn"),q=document.getElementById("us-cert-manage-btn");q&&(q.setAttribute("value",b.IDS_CERT_MANAGE,0),q.onclick=function(){k||ma(this)},q.display="block",q.visibility="visible");a.uiUtil().isIraq()&&(c.style.visibility="hidden",f.style.visibility="hidden");if(a.ESVS.Embedded)t.setAttribute("tabindex",z++,0),l.setAttribute("tabindex",z++,0),c.setAttribute("tabindex",z++,0),f.setAttribute("tabindex",z++,0),h.setAttribute("tabindex",z++,0),d&&d.setAttribute("tabindex",z++,0);else if(t.setAttribute("tabindex",z++,0),"none"!=document.getElementById("us-div-cert").style.display&&l.setAttribute("tabindex",z++,0),c.setAttribute("tabindex",z++,0),f.setAttribute("tabindex",z++,0),h.setAttribute("tabindex",z++,0),d&&d.setAttribute("tabindex",z++,0),"none"==document.getElementById("us-div-cert").style.display&&l.setAttribute("tabindex",z++,0),q.setAttribute("tabindex",z++,0),u.setAttribute("value",b.IDS_CLOSE,0),u.setAttribute("tabindex",z++,0),u.onclick=function(){k&&a.ESVS.chkEXESetup||M()},l=document.getElementById("us-lbl-notice"),l.appendChild(document.createTextNode(b.IDS_NOTICE)),"MPKI"==a.ESVS.PKI||a.uiUtil().isIraq())l.style.visibility="hidden";u.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(u.onblur=function(){setTimeout(function(){q.focus()},10)});9!=b||a.shiftKey||(u.onblur=function(){setTimeout(function(){g.focus()},10)})};var v=!1;g.onkeyup=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&v&&(v=!1,setTimeout(function(){u.focus()},10))};g.onkeydown=function(a){a=a||window.event;if(9==(a.which||a.keyCode)&&a.shiftKey)return a.cancelBubble=!0,v=a.returnValue=!0,!1};null!=a.options.popup&&(document.getElementById("us-div-cert-select").className=document.getElementById("us-div-cert-select").className+" popup");a.ESVS.ShowGuide&&C(m);0<=a.ESVS.PKI.indexOf("MilPKI")&&(c.style.display="none",c.style.visibility="hidden",d.style.display="none",d.style.visibility="hidden",h.style.display="none",h.style.visibility="hidden",f.style.display="none",f.style.visibility="hidden",q.style.display="none",q.style.visibility="hidden");"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type&&(q.style.display="none",q.style.visibility="hidden");"CERT_SELECT"==e.type&&da("123456789012345678901234567890");return document.getElementById("us-div-cert-select")}()};return function(e){function x(){function e(){0<v.value.length?v.value="":(5>x&&setTimeout(e,10),x++)}var v=document.getElementById("us-pw-text"),x=0;e();a.uiUtil().setFirstFocus("us-lbl-title");for(var F=a.ESVS.Media.list.split("|"),G=0;G<F.length;G++){var L=a.CONST.medias[F[G]];if(void 0!=L&&null!=L&&(L=document.getElementById("us-btn-"+L.name))&&"us-layout-storage-btn-on"==L.className){a.bsUtil().SetSecurityStatus("us-pw-text");a.bsUtil().SetReScan();break}}}var v=W({type:e.type,args:e.args,onConfirm:e.onConfirm,onCancel:e.onCancel});if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){e=a.uiLayerLevel;var F=a.uiUtil().getOverlay(e);v.style.zIndex=e+1;document.body.insertBefore(F,document.body.firstChild)}var G=window.onresize;return{show:function(){a.ActiveUI=this;a.ESVS.Embedded?(v.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(v,"width","width")))/2+"px",v.style.display="block"):null==a.options.popup?(draggable(v,document.getElementById("us-div-title")),F.style.display="block",a.uiUtil().offsetResize(v)):(-1<a.options.popup.indexOf("move=true")?draggable(v,document.getElementById("us-div-title")):document.getElementById("us-div-title").style.cursor="default",-1<a.options.popup.indexOf("overlay=true")&&(F.style.display="block"),a.uiUtil().offsetResize(v,a.options.popup));window.onresize=a.ESVS.Embedded?function(){v&&(v.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(v,"width","width")))/2+"px");G&&G()}:function(){v&&a.uiUtil().offsetResize(v,a.options.popup);G&&G()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;a.bsUtil().ahnlabInit();setTimeout(function(){x()},10)},hide:function(){a.ESVS.Embedded||(F.style.display="none",v.style.display="none")},dispose:function(e){1==e&&4&a.ESVS.Mode&&a.ESVS.chkEXESetup&&a.nimservice().ClearAllUserCertList(function(a,e){});window.onresize=function(){G&&G()};!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))&&((e=v.parentNode)&&e.removeChild(v),F.parentNode&&F.parentNode.removeChild(F),a.uiLayerLevel-=10,a.ESVS.TabIndex-=30)}}}};