(function(){function s(b){var g=b.jsustoolkitErrCode=b.jsustoolkitErrCode||{},e=b.x509Certificate=b.x509Certificate||{},c=null,q=null,f=b.asn1,r={name:"CertificateListInfo",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateListInfo.tbsCertList",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"TBSCertList"},{name:"CertificateListInfo.signatureAlgorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"CertificateListInfo.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"signatureOid"},{name:"CertificateListInfo.parameters",tagClass:f.Class.UNIVERSAL,optional:!0,captureAsn1:"signatureParams"}]},{name:"CertificateListInfo.signatureValue",tagClass:f.Class.UNIVERSAL,type:f.Type.BITSTRING,constructed:!1,capture:"signature"}]},s={name:"tbsCertList",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertListInfo",value:[{name:"tbsCertListInfo.version",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,optional:!0,capture:"certListVersion"},{name:"tbsCertListInfo.signature",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"tbsCertListInfo.signature.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"certListInfoSignatureOid"},{name:"tbsCertListInfo.signature.parameters",tagClass:f.Class.UNIVERSAL,optional:!0,captureAsn1:"certListInfoSignatureParams"}]},{name:"tbsCertListInfo.issuer",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"certListIssuer"},{name:"tbsCertListInfo.thisUpdate",tagClass:f.Class.UNIVERSAL,type:f.Type.UTCTIME,constructed:!1,capture:"thisUpdate"},{name:"tbsCertListInfo.nextUpdate",tagClass:f.Class.UNIVERSAL,type:f.Type.UTCTIME,constructed:!1,optional:!0,capture:"nextUpdate"},{name:"tbsCertListInfo.revokedCertificaates",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"revokedCertificaates"},{name:"tbsCertListInfo.extensions",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"certListInfoExtensions"}]},t="unspecified keyCompromise caCompromise affiliationChanged superseded cessationOfOperation certificateHold removeFromCRL".split(" ");e.parser=function(a,d){if(null==a||"undefined"==typeof a)throw{code:"112050",message:g["112050"]};if("PEM"==d)c=b.pki.certificateFromPem(a);else if("Base64"==d)c=b.pki.certificateFromBase64(a);else if("ASN1"==d)c=b.pki.certificateFromAsn1(a);else throw{code:"112051",message:g["112051"]};q=new e.certUtil;return c};e.getVersion=function(){return c.version+1};e.getSerialNumber=function(){return c.serialNumber};e.getSignAlgo=function(){return b.pki.oids[c.signatureOid]};e.getSignHashAlgo=function(){return e.getSignAlgo().substring(0,e.getSignAlgo().indexOf("with"))};e.getIssuerName=function(){return q.getDN(c.issuer)};e.getNotBefore=function(){return c.validity.notBefore};e.getNotAfter=function(){return c.validity.notAfter};e.getSubjectName=function(){return q.getDN(c.subject)};e.getSignature=function(){return b.util.bytesToHex(c.signature)};e.getPublickeyAlgo=function(){var a=b.pki.oids[c.publicKeyOid];null==a&&(a=c.publicKeyOid);return a};e.getPublickey=function(){return c.publicKeyOid==b.pki.oids.RSAEncryption?b.asn1.toDer(c.rsaPublicKey).toHex():b.asn1.toDer(c.publicKey.value[0]).toHex()};e.getAuthorityInfoAccess=function(){if(null==c.getExtension("authorityInfoAccess"))return"";var a=b.asn1.fromDer(c.getExtension("authorityInfoAccess").value).value[0];return"AccessMethod ="+b.pki.oids[b.asn1.derToOid(a.value[0].value)]+"("+b.asn1.derToOid(a.value[0].value)+")\nAlternativeName = "+a.value[1].value};e.getAuthorityKeyIdentifier=function(){if(null==c.getExtension("authorityKeyIdentifier"))return"";var a=b.asn1.fromDer(c.getExtension("authorityKeyIdentifier").value);return a.value[2]?"KeyID ="+b.util.bytesToHex(a.value[0].value)+"\nCertificate SerialNumber="+b.util.bytesToHex(a.value[2].value)+"\n":"KeyID ="+b.util.bytesToHex(a.value[0].value)+"\n"};e.getSubjectKeyIdentifier=function(){return null==c.getExtension("subjectKeyIdentifier")?"":b.util.bytesToHex(b.asn1.fromDer(c.getExtension("subjectKeyIdentifier").value).value)};e.getKeyUsage=function(){var a=c.getExtension("keyUsage"),d="";null!==a&&(a.digitalSignature&&(d+="digitalSignature,"),a.nonRepudiation&&(d+="nonRepudiation,"),a.keyEncipherment&&(d+="keyEncipherment,"),a.dataEncipherment&&(d+="dataEncipherment,"),a.keyAgreement&&(d+="keyAgreement,"),a.keyCertSign&&(d+="keyCertSign,"),a.cRLSign&&(d+="cRLSign,"),a.encipherOnly&&(d+="encipherOnly,"),a.decipherOnly&&(d+="decipherOnly,"),d=d.substring(0,d.length-1));return d};e.getCertificatePoliciesOid=function(){if(null==c.getExtension("certificatePolicies"))return"";var a=b.asn1.fromDer(c.getExtension("certificatePolicies").value),d=a.value[0];a.value[1]&&(d=a.value[1]);return b.asn1.derToOid(d.value[0].value)};e.getCertificatePoliciesCPS=function(){if(null!=c.getExtension("certificatePolicies")){var a=b.asn1.fromDer(c.getExtension("certificatePolicies").value),d=a.value[0].value[1];a.value[1]&&(d=a.value[1].value[1]);if(null==d)return"";for(a=0;a<d.value.length;a++)if("cps"==b.pki.oids[b.asn1.derToOid(d.value[a].value[0].value)])return d.value[a].value[1].value}return""};e.getCertificatePoliciesUserNotice=function(){if(null!=c.getExtension("certificatePolicies")){var a=b.asn1.fromDer(c.getExtension("certificatePolicies").value),d=a.value[0].value[1];a.value[1]&&(d=a.value[1].value[1]);if(null==d)return"";for(a=0;a<d.value.length;a++)if("unotice"==b.pki.oids[b.asn1.derToOid(d.value[a].value[0].value)])return d.value[a].value[1].value[0].value}return""};e.getSubjectAltName=function(){if(null==c.getExtension("subjectAltName"))return"";for(var a=b.asn1.fromDer(c.getExtension("subjectAltName").value),d="",p=0;p<a.value.length;p++)1==a.value[p].type?d+="RFC822Name = "+a.value[p].value:0==a.value[p].type&&(d+="Other Name: "+b.asn1.derToOid(a.value[p].value[0].value)+"="+b.asn1.toDer(a.value[p].value[1].value[0]).toHex()),p!=a.value.length-1&&(d+="\n");return d};e.getcRLDistributionPoints=function(){if(null==c.getExtension("cRLDistributionPoints"))return"";var a=b.asn1.fromDer(c.getExtension("cRLDistributionPoints").value);return a.value[1]?a.value[1].value[0].value[0].value[0].value:a.value[0].value[0].value[0].value[0].value};e.crlDownload=function(a,d){var b=null;if(window.XMLHttpRequest)b=new window.XMLHttpRequest;else try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){b=null}}b.open("POST",a+"LdapProxy.do",!1);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.setRequestHeader("Cache-Control","no-cache, must-revalidate");b.setRequestHeader("Pragma","no-cache");b.withCredentials=!0;b.send("ldapurl="+d);return 200==b.status&&(b=b.responseText)?JSON.parse(b):null};e.verifyCRL=function(a,d){var c={verify:!1},n=new Date;if(n<e.getNotBefore()||n>e.getNotAfter())c.verify=!1,c.revocationDate=e.getNotAfter(),c.reason="Certificate has expired.",c.errCode=-1;else{var h={},n={},k=[];d=f.fromDer(d);if(!f.validate(d,r,h,k))throw{code:"112052",message:g["112052"]};if(!f.validate(h.TBSCertList,s,n,k))throw{code:"112053",message:g["112053"]};if(!f.fromDer(n.certListInfoExtensions.value[0].value[0].value[1].value).value[0].value==f.fromDer(a.getExtension("subjectKeyIdentifier").value).value)throw{code:"112054",message:g["112054"]};k=b.util.createBuffer(h.signature);++k.read;var k=k.getBytes(),l=h.TBSCertList,m=f.derToOid(h.signatureOid),h=k;if(null==a||"undefined"==typeof a)throw{code:"112053",message:g["112053"]};if(null==l||"undefined"==typeof l)throw{code:"112054",message:g["112054"]};if(null==m||"undefined"==typeof m)throw{code:"112055",message:g["112055"]};if(null==h||"undefined"==typeof h)throw{code:"112056",message:g["112056"]};var q=!1,k=null;if(a.signatureOid in b.pki.oids)switch(b.pki.oids[a.signatureOid]){case "sha1WithRSAEncryption":k=b.md.sha1.create();break;case "md5WithRSAEncryption":k=b.md.md5.create();break;case "sha256WithRSAEncryption":k=b.md.sha256.create();break;case "RSASSA-PSS":k=b.md.sha256.create()}else throw{code:"112057",message:g["112057"]};l=f.toDer(l);k.update(l.getBytes());if(null!==k){l=void 0;m=b.pki.oids[m];switch(m){case "sha1WithRSAEncryption":case "sha256WithRSAEncryption":l=void 0;break;case "RSASSA-PSS":m=oids[child.signatureParameters.mgf.hash.algorithmOid];if(void 0===m||void 0===b.md[m])throw{code:"112028",message:g["112028"]+"(oid:"+child.signatureParameters.mgf.hash.algorithmOid+")"};l=oids[child.signatureParameters.mgf.algorithmOid];if(void 0===l||void 0===b.mgf[l])throw{code:"112029",message:g["112029"]+"(oid:"+child.signatureParameters.mgf.algorithmOid+")"};l=b.mgf[l].create(b.md[m].create());m=oids[child.signatureParameters.hash.algorithmOid];if(void 0===m||void 0===b.md[m])throw{code:"112030",message:g["112030"]+"(oid:"+child.signatureParameters.hash.algorithmOid+")"};l=b.pss.create(b.md[m].create(),l,child.signatureParameters.saltLength)}q=a.publicKey.verify(k.digest().getBytes(),h,l)}if(q)if(h=f.fromDer(n.certListInfoExtensions.value[0].value[2].value[2].value).value[0].value[0].value[0].value,e.getcRLDistributionPoints()==h){for(h=0;h<n.revokedCertificaates.value.length;h++)if(e.getSerialNumber()==b.util.bytesToHex(n.revokedCertificaates.value[h].value[0].value)){c.verify=!1;c.errCode=-2;c.revocationDate=f.utcTimeToDate(n.revokedCertificaates.value[h].value[1].value);c.reason=t[f.fromDer(n.revokedCertificaates.value[h].value[2].value[0].value[1].value).value.charCodeAt(0)];break}"undefined"==typeof c.revocationDate&&(c.verify=!0)}else c.verify=!1,c.errCode=-3,c.reason="IssuingDistributionPoint is not CRLDP path.";else c.errCode=-4,c.verify=!1,c.reason="CRL signature verify failed."}return c};e.certUtil=function(){};e.certUtil.prototype.getDN=function(a){for(var d="",c=0;c<a.attributes.length;c++)d=d+a.attributes[a.attributes.length-(c+1)].shortName+"="+b.util.createBuffer(a.attributes[a.attributes.length-(c+1)].value).toString(),c!=a.attributes.length-1&&(d+=",");return d}}var t=["./pki","./oids","./jsustoolkitErrCode"],r=null;"function"!==typeof define&&("object"===typeof module&&module.exports?r=function(b,g){g(require,module)}:(crosscert=window.crosscert=window.crosscert||{},s(crosscert)));(r||"function"===typeof define)&&(r||define)(["require","module"].concat(t),function(b,g){g.exports=function(e){var c=t.map(function(c){return b(c)}).concat(s);e=e||{};e.defined=e.defined||{};if(e.defined.x509Certificate)return e.x509Certificate;e.defined.x509Certificate=!0;for(var g=0;g<c.length;++g)c[g](e);return e.x509Certificate}})})();